type: substreams-sink-sql
config:
    engine: postgresql
    dsn: "postgresql://tron_user:tron_password@localhost:5432/tron_transactions"
    schema: "./schema.sql"

# Transform the substreams data into database inserts
transforms:
    - name: tron_transactions
      sql: |
          INSERT INTO tron_transactions (
            transaction_hash, 
            block_number, 
            block_timestamp, 
            contract_type, 
            contract_address, 
            from_address, 
            to_address, 
            value, 
            fee, 
            result, 
            raw_data
          ) VALUES (
            $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11
          ) ON CONFLICT (transaction_hash) DO UPDATE SET
            block_number = EXCLUDED.block_number,
            block_timestamp = EXCLUDED.block_timestamp,
            contract_type = EXCLUDED.contract_type,
            contract_address = EXCLUDED.contract_address,
            from_address = EXCLUDED.from_address,
            to_address = EXCLUDED.to_address,
            value = EXCLUDED.value,
            fee = EXCLUDED.fee,
            result = EXCLUDED.result,
            raw_data = EXCLUDED.raw_data;
